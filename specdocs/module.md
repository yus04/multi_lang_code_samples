# モジュール処理プログラム設計書   
   
## 1. 概要  
   
本ドキュメントは、PL/I 言語で実装されたモジュール `PTMPPLT` の仕様を説明します。本モジュールは、NetView 環境での高水準言語 (HLL) プログラムのテンプレートとして機能します。コマンドプロセッサやインストール時のエグジットとして動作し、入力されたコマンドやメッセージの処理を行います。  
   
## 2. モジュール情報  
   
| 項目         | 内容                                                     |  
|--------------|----------------------------------------------------------|  
| モジュール名 | PTMPPLT                                                  |  
| 言語         | PL/I                                                     |  
| オプション   | MAIN, REENTRANT                                          |  
| 著作権       | IBM Corporation 1989, 1995                               |  
| 使用目的     | NetView 環境での HLL モジュール作成のためのテンプレート |  
   
## 3. 機能概要  
   
本モジュールは、NetView 環境で HLL を使用してモジュールを作成する際のテンプレートとして使用されます。主な機能は以下のとおりです。  
   
- コマンドプロセッサまたはインストール時のエグジットとして動作  
- コマンドやメッセージの入力を受け取り処理を開始  
- 処理結果に応じたリターンコードを返却  
   
## 4. 入出力仕様  
   
### 4.1 入力  
   
1. **HLBPTR**: HLB コントロールブロックのアドレスを含む 4 バイトのフィールドへのポインタ。  
2. **CMDBUF**: 可変長の文字列で、プログラムを呼び出したコマンドまたはメッセージを含む。  
   - コマンドプロセッサとして呼び出された場合：コマンド文字列  
   - インストール時のエグジットとして呼び出された場合（DSIEX02A を除く）：メッセージ文字列  
   - DSIEX02A として呼び出された場合：この文字列は空であり、メッセージは初期データキュー (IDATAQ) から取得する必要がある。  
3. **ORIGBLCK**: このプログラムの実行を引き起こしたリクエストの発信元を記述する 40 バイトの構造体。  
   
### 4.2 出力  
   
- 必要に応じてメッセージバッファの内容を変更または維持。  
- 処理結果に応じたリターンコードを `HLBRC` に設定。  
   
### 4.3 リターンコード  
   
**コマンドプロセッサの場合:**  
   
- `0`: 正常終了  
- `-5`: キャンセル  
   
**インストール時のエグジットの場合:**  
   
- `0`: `USERASIS`（メッセージバッファの内容を変更せずそのままにする）  
- `4`: `USERDROP`（メッセージバッファを削除）  
- `8`: `USERSWAP`（メッセージバッファの内容を変更）  
   
## 5. 依存関係  
   
- 使用するマクロを含むインクルードファイル: `DSIPLI`（NetView HLL マクロのインクルード）  
- 実行時オプション: `HLLOPTS`（非プリイニシャライズに設定、`HLLENV` コマンドの `DEFAULT` キーワードの値に関係なく設定される）  
   
## 6. 制約  
   
- 本モジュールは NetView 環境下でのみ動作します。  
- 入力されるデータ（コマンドやメッセージ）が適切であることが前提です。  
- DSIEX02A として実行される場合、`CMDBUF` は空であり、メッセージは `IDATAQ` から取得する必要があります。  
   
## 7. 内部仕様  
   
### 7.1 データ構造  
   
- **HLBPTR**: HLB（High-Level Block）のアドレスを指すポインタ。  
- **CMDBUF**: 入力されたコマンドまたはメッセージを保持する可変長文字列。  
- **ORIGBLCK**: リクエストの発信元情報を保持する 40 バイトのブロック。  
- **ORIGIN**: `ORIGBLCK` のアドレスを格納するポインタ。  
   
### 7.2 初期化処理  
   
- `ORIGIN` に `ORIGBLCK` のアドレスを設定します。  
  ```pli  
  ORIGIN = ADDR(ORIGBLCK);  
  ```  
   
### 7.3 実行処理  
   
- 正常終了を示すリターンコードを `HLBRC` に設定します。  
  ```pli  
  HLBRC = CNM_GOOD;  
  ```  
   
### 7.4 終了処理  
   
- プログラムの処理を終了します。  
  ```pli  
  END PTMPPLT;  
  ```  
   
## 8. 外部モジュール参照  
   
- 特定の外部モジュールは呼び出していませんが、必要に応じて他のモジュールを呼び出すことが可能です。  
   
## 9. 変更履歴  
   
| 日付       | 作者     | 変更内容               |  
|------------|----------|------------------------|  
| YYYY-MM-DD | 作成者名 | 初回作成               |  
| YYYY-MM-DD | 修正者名 | 機能追加やバグ修正など |  
   
## 10. 使用例  
   
### 10.1 コマンドプロセッサとしての利用  
   
- **手順:**  
  1. NetView 環境でコマンド `PTMPPLT` を実行します。  
  2. コマンド文字列を `CMDBUF` に渡します。  
   
- **期待される結果:**  
  - 入力されたコマンドが `CMDBUF` に格納され、モジュールが処理を行います。  
  - 正常に処理が完了すると、`HLBRC` に `0` が設定されます。  
   
### 10.2 インストール時のエグジットとしての利用  
   
- **手順:**  
  1. 適切なエグジットポイントでモジュール `PTMPPLT` を設定します。  
  2. メッセージが発生した際にモジュールが呼び出されます。  
   
- **期待される結果:**  
  - メッセージバッファの内容が必要に応じて処理されます。  
  - 処理結果に応じたリターンコード（`0`, `4`, `8`）が `HLBRC` に設定されます。  
