# バッチ処理プログラム設計書  
   
## 1. 概要  
   
本ドキュメントは、PL/I 言語で実装されたバッチ処理プログラム `DLITPLI` の仕様を説明します。本プログラムは、IMS データベースを操作し、ディテールセグメントとマスターセグメントの取得および更新を行います。  
   
## 2. モジュール情報  
   
| 項目         | 内容                             |  
|--------------|----------------------------------|  
| モジュール名 | DLITPLI                          |  
| 言語         | PL/I                             |  
| オプション   | MAIN                             |  
| 著作権       | （必要に応じて記載）             |  
| 使用目的     | IMS データベースの操作（バッチ） |  
   
## 3. 機能概要  
   
本プログラムは、IMS データベースに対して以下の機能を提供します。  
   
- 資格条件付きでディテールセグメントを取得（`GU` 関数）  
- マスターセグメントを取得し、親セグメントへ移動（`GHU`, `GHN` 関数）  
- マスターセグメントの内容を更新（`REPL` 関数）  
- 各処理におけるエラーハンドリング  
   
## 4. 入出力仕様  
   
### 4.1 入力  
   
- `IO_PTR_PCB`: 入出力 PCB へのポインタ  
- `DB_PTR_MAST`: マスターデータベース PCB へのポインタ  
- `DB_PTR_DETAIL`: ディテールデータベース PCB へのポインタ  
   
### 4.2 出力  
   
- マスターセグメントおよびディテールセグメントのデータ取得結果  
- データベースの更新結果  
- ステータスコードの更新  
   
### 4.3 リターンコード  
   
- 正常終了時はプログラムを終了（`RETURN`）  
- エラー発生時にはエラーメッセージを出力（具体的なリターンコードはプログラム内で定義）  
   
## 5. 依存関係  
   
- IMS データベース環境が必要  
- DL/I 関数を使用するため、`PLITDLI` プロシージャをコール  
- 定義済みの関数コード（例：`GU  `, `GHU `, `GHN `, `REPL`）  
   
## 6. 制約  
   
- IMS データベースの構造に依存（セグメント名、キー名など）  
- 資格条件付き SSA の値（`SEG_NAME`, `SEG_KEY_VALUE` など）は実際のデータベースに合わせる必要あり  
- ステータスコード `GOOD_STATUS_CODE` は正常終了を示すコードとしてプログラム内で定義されていること  
   
## 7. 内部仕様  
   
### 7.1 データ構造  
   
- **SSA（Segment Search Argument）**:  
  - 資格条件付き SSA（`QUAL_SSA`）: 特定のセグメントを検索するための条件を設定  
  - 資格条件なし SSA（`UNQUAL_SSA`）: セグメント名のみ指定  
- **セグメント IO エリア**:  
  - `MAST_SEG_IO_AREA`: マスターセグメントのデータを格納  
  - `DET_SEG_IO_AREA`: ディテールセグメントのデータを格納  
- **PCB（Program Communication Block）**:  
  - `IO_PCB`: 入出力制御用の PCB  
  - `DB_PCB_MAST`: マスターデータベースアクセス用の PCB  
  - `DB_PCB_DETAIL`: ディテールデータベースアクセス用の PCB  
   
### 7.2 初期化処理  
   
- 各種定数や関数コードを初期化（例：`FUNC_GU`, `FUNC_GHU` など）  
- SSA 構造体を初期化し、適切な値を設定  
   
### 7.3 実行処理  
   
1. **ディテールセグメントの取得（`GU`）**  
  
   - `PLITDLI` をコールして、資格条件付きでディテールセグメントを取得  
   - ステータスコードを確認し、正常終了であれば次の処理へ  
   
2. **マスターセグメントの取得（`GHU`）**  
  
   - `PLITDLI` をコールして、マスターセグメントを取得  
   - ステータスコードを確認し、正常終了であれば次の処理へ  
   
3. **親セグメントへの移動（`GHN`）**  
  
   - `PLITDLI` をコールして、親セグメントへ移動  
   - ステータスコードを確認し、正常終了であれば次の処理へ  
   
4. **マスターセグメントの更新（`REPL`）**  
  
   - セグメントの内容を必要に応じて変更  
   - `PLITDLI` をコールして、セグメントを更新  
   - ステータスコードを確認し、エラーであればエラーメッセージを出力  
   
5. **エラーハンドリング**  
  
   - 各ステップでステータスコードを確認し、エラー時には適切な処理を行う  
   - エラーメッセージの出力やロギングなど  
   
### 7.4 終了処理  
   
- 処理が完了したらプログラムを終了する  
   
## 8. 変更履歴  
   
| 日付       | 作者     | 変更内容             |  
|------------|----------|----------------------|  
| YYYY-MM-DD | 作成者名 | 初回作成             |  
| YYYY-MM-DD | 修正者名 | 機能追加やバグ修正等 |  
   
## 9. 使用例  
   
- **目的**: ディテールセグメントを取得し、関連するマスターセグメントを更新する  
- **手順**:  
  1. 必要なポインタ（`IO_PTR_PCB`, `DB_PTR_MAST`, `DB_PTR_DETAIL`）を用意  
  2. 資格条件付き SSA を適切な値に設定（例：検索したいキー値を設定）  
  3. プログラム `DLITPLI` を実行  
- **期待される結果**:  
  - 指定した条件のディテールセグメントおよびマスターセグメントが正しく取得される  
  - マスターセグメントの内容が更新される  
  - エラーが発生した場合は、適切なエラーメッセージが出力される  
